# ==============================================================================
# ПРИМЕР КОНФИГУРАЦИИ ДЛЯ FOX TELEGRAM SUMMARIZER BOT
# ==============================================================================
# 
# Этот файл содержит примеры настроек для бота суммаризации сообщений.
# Скопируйте этот файл в config.yaml и настройте под свои нужды.
#
# ВАЖНО: 
# - Все значения в этом файле являются примерами
# - Замените chat_id и username на реальные значения ваших каналов/групп
# - Убедитесь, что бот добавлен в каналы как администратор с правами чтения
# ==============================================================================

# ------------------------------------------------------------------------------
# НАСТРОЙКИ ПО УМОЛЧАНИЮ (defaults)
# ------------------------------------------------------------------------------
# Эти настройки применяются ко всем чатам, если не переопределены в секции chats
# ------------------------------------------------------------------------------

defaults:
  # ----------------------------------------------------------------------------
  # ВРЕМЕННАЯ ЗОНА (timezone)
  # ----------------------------------------------------------------------------
  # Используется для корректного определения временных интервалов суммаризации
  # и преобразования времени ежедневной отправки в UTC
  #
  # Поддерживаются два формата:
  # 1. IANA формат (рекомендуется для зон с летним временем):
  #    "Europe/Moscow", "America/New_York", "Asia/Tokyo" и т.д.
  #    Автоматически учитывает переходы на летнее/зимнее время
  #
  # 2. UTC смещение (проще для фиксированных зон):
  #    "+03:00", "-05:00", "+03:00:00", "-05:30" и т.д.
  #    Фиксированное смещение от UTC, не учитывает летнее время
  #
  # Примеры:
  #   timezone: "Europe/Moscow"     # Москва (UTC+3, с учетом летнего времени)
  #   timezone: "+03:00"            # Фиксированное UTC+3
  #   timezone: "America/New_York"  # Нью-Йорк (UTC-5/-4 в зависимости от сезона)
  #   timezone: "-05:00"            # Фиксированное UTC-5
  #
  timezone: "Europe/Moscow"

  # ----------------------------------------------------------------------------
  # НАСТРОЙКИ ТЕМ (topics)
  # ----------------------------------------------------------------------------
  # Параметры, влияющие на то, какие темы будут включены в суммаризацию
  # и как они будут отображаться
  # ----------------------------------------------------------------------------
  
  topics:
    # --------------------------------------------------------------------------
    # only_top: включить только "топовые" темы
    # --------------------------------------------------------------------------
    # true  - включать только темы с минимум min_messages сообщений
    # false - включать все темы, найденные LLM (рекомендуется)
    #
    # Пример: если min_messages: 5 и only_top: true,
    # то в суммаризацию попадут только темы с 5+ сообщениями
    #
    only_top: false

    # --------------------------------------------------------------------------
    # min_messages: минимальное количество сообщений в теме
    # --------------------------------------------------------------------------
    # Тема должна содержать минимум столько сообщений, чтобы быть включенной
    # в суммаризацию (если only_top: true) или считаться "топовой"
    #
    # Рекомендуемые значения:
    #   - 3-5   для активных каналов с большим количеством сообщений
    #   - 1-2   для небольших каналов или если нужны все темы
    #
    min_messages: 5

    # --------------------------------------------------------------------------
    # max_topics: максимальное количество тем в суммаризации
    # --------------------------------------------------------------------------
    # Ограничивает количество тем в итоговой суммаризации
    # 
    # 0 или отсутствие - без ограничения (все найденные темы)
    # Любое положительное число - максимум тем для отображения
    #
    # Примеры:
    #   max_topics: 0   - показать все темы (по умолчанию)
    #   max_topics: 10  - показать максимум 10 самых важных тем
    #   max_topics: 5   - показать только топ-5 тем
    #
    max_topics: 0

    # --------------------------------------------------------------------------
    # show_users: показывать список участников в каждой теме
    # --------------------------------------------------------------------------
    # true  - в каждой теме будет показан список участников с их именами
    # false - участники не отображаются (рекомендуется для больших каналов)
    #
    # Формат отображения:
    #   Если у пользователя есть username: [Имя Фамилия](https://t.me/username)
    #   Если username нет: просто текст с именем
    #
    # Пример вывода:
    #   - Тема обсуждения (ссылка) (15). Описание темы.
    #   (Иван Петров, Мария Смирнова, Алексей)
    #
    show_users: false

    # --------------------------------------------------------------------------
    # user_list_length: максимальное количество участников для отображения
    # --------------------------------------------------------------------------
    # Ограничивает количество участников, показываемых в каждой теме
    # Участники сортируются по активности (количество сообщений в теме)
    #
    # 0 - без ограничения (показать всех участников)
    # Любое положительное число - максимум участников для отображения
    #
    # Примеры:
    #   user_list_length: 10  - показать топ-10 самых активных участников
    #   user_list_length: 5   - показать только 5 самых активных
    #   user_list_length: 0   - показать всех участников (может быть длинно)
    #
    user_list_length: 10

    # --------------------------------------------------------------------------
    # show_user_links: показывать ссылки на профили пользователей
    # --------------------------------------------------------------------------
    # true  - имена участников отображаются как ссылки на их профили
    #         [Имя Фамилия](https://t.me/username) если есть username
    # false - имена участников отображаются просто как текст без ссылок
    #         Имя Фамилия (даже если есть username)
    #
    # ВАЖНО: Работает только если show_users: true
    #
    # Примеры:
    #   show_user_links: true  - [Иван Петров](https://t.me/ivan_petrov)
    #   show_user_links: false - Иван Петров
    #
    show_user_links: true

    # --------------------------------------------------------------------------
    # prompt: путь к кастомному промпту для суммаризации (ОПЦИОНАЛЬНО)
    # --------------------------------------------------------------------------
    # Если нужно использовать свой промпт вместо стандартного
    # Указывается относительно корня проекта
    #
    # По умолчанию используется: prompts/summarization_prompt.txt
    #
    # Пример:
    #   prompt: "prompts/custom_summarization_prompt.txt"
    #
    # prompt: "prompts/custom_summarization_prompt.txt"

    # --------------------------------------------------------------------------
    # structured_system_prompt: путь к кастомному системному промпту (ОПЦИОНАЛЬНО)
    # --------------------------------------------------------------------------
    # Если нужно использовать свой системный промпт для structured output
    # Указывается относительно корня проекта
    #
    # По умолчанию используется: prompts/structured_system_prompt.txt
    #
    # Пример:
    #   structured_system_prompt: "prompts/custom_structured_system_prompt.txt"
    #
    # structured_system_prompt: "prompts/custom_structured_system_prompt.txt"

  # ----------------------------------------------------------------------------
  # НАСТРОЙКИ СУММАРИЗАЦИИ (summarize)
  # ----------------------------------------------------------------------------
  # Параметры, управляющие командами и автоматической суммаризацией
  # ----------------------------------------------------------------------------
  
  summarize:
    # --------------------------------------------------------------------------
    # command_enabled: включить/отключить команду /summarize
    # --------------------------------------------------------------------------
    # true  - пользователи могут использовать команду /summarize для ручной суммаризации
    # false - команда отключена, суммаризация только автоматическая (если включена)
    #
    command_enabled: true

    # --------------------------------------------------------------------------
    # daily_enabled: включить автоматическую ежедневную суммаризацию
    # --------------------------------------------------------------------------
    # true  - бот будет автоматически создавать и отправлять суммаризацию каждый день
    #         в указанное время (daily_time)
    # false - автоматическая суммаризация отключена
    #
    # ВАЖНО: Для работы ежедневной суммаризации нужно настроить cron или планировщик задач
    # См. файл daily_summary.py и crontab для примеров настройки
    #
    daily_enabled: false

    # --------------------------------------------------------------------------
    # day_start_time: время начала "дня" для вычисления интервала суммаризации
    # --------------------------------------------------------------------------
    # Формат: "ЧЧ:ММ" (24-часовой формат, время в указанной временной зоне timezone)
    #
    # Определяет временное окно для суммаризации:
    #   Интервал = [предыдущий day_start_time - 24 часа, предыдущий day_start_time)
    #
    # Примеры:
    #   day_start_time: "06:00"  - день начинается в 6 утра
    #                             суммаризация включает сообщения с 6:00 предыдущего дня до 6:00 текущего дня
    #   day_start_time: "00:00"  - день начинается в полночь (стандартный календарный день)
    #
    # Рекомендуется: "06:00" или "00:00" в зависимости от активности канала
    #
    day_start_time: "06:00"

    # --------------------------------------------------------------------------
    # daily_time: время отправки ежедневной суммаризации
    # --------------------------------------------------------------------------
    # Формат: "ЧЧ:ММ" (24-часовой формат, время в указанной временной зоне timezone)
    #
    # Время, когда бот будет автоматически создавать и отправлять суммаризацию
    # (если daily_enabled: true)
    #
    # Примеры:
    #   daily_time: "23:00"  - отправлять каждый день в 23:00 (перед сном)
    #   daily_time: "09:00"  - отправлять каждый день в 9:00 (утренний дайджест)
    #   daily_time: "12:00"  - отправлять в полдень
    #
    # ВАЖНО: Время указывается в временной зоне, указанной в timezone
    # Код автоматически преобразует его в UTC для корректной работы в Docker
    #
    daily_time: "23:00"

    # --------------------------------------------------------------------------
    # summary_start_time: время отсечки для команды /summarize
    # --------------------------------------------------------------------------
    # Формат: "ЧЧ:ММ" (24-часовой формат, время в указанной временной зоне timezone)
    #
    # Если задано, команда /summarize возвращает суммаризацию с этого времени
    # сегодняшнего дня до текущего момента (незавершенный период).
    # Если не задано, команда возвращает суммаризацию за все неархивированные сообщения.
    #
    # Примеры:
    #   summary_start_time: "06:00"  - суммаризация с 6 утра сегодня до текущего момента
    #   summary_start_time: "00:00"  - суммаризация с полуночи сегодня
    #
    # ВАЖНО: Время указывается в временной зоне, указанной в timezone
    # Если время отсечки в будущем (например, сейчас 10:00, а задано 12:00),
    # команда вернет все сообщения (как если бы параметр не был задан)
    #
    # summary_start_time: "06:00"

    # --------------------------------------------------------------------------
    # summarize_template: путь к кастомному шаблону суммаризации (ОПЦИОНАЛЬНО)
    # --------------------------------------------------------------------------
    # Если нужно использовать свой шаблон форматирования вместо стандартного
    # Указывается относительно корня проекта
    #
    # По умолчанию используется: templates/summarize_default.txt
    #
    # Шаблоны используют синтаксис Jinja2 и поддерживают переменные:
    #   {{ header }}     - заголовок суммаризации
    #   {{ topics }}     - список тем (цикл через {% for topic in topics %})
    #   {{ footer }}     - футер суммаризации
    #
    # Примеры переменных темы:
    #   topic.topic          - название темы
    #   topic.link           - ссылка на первое сообщение темы
    #   topic.description    - описание темы
    #   topic.message_count  - количество сообщений в теме
    #   topic.participants   - список участников (если show_users=true)
    #
    # Пример:
    #   summarize_template: "templates/custom_summarize.txt"
    #
    # summarize_template: "templates/summarize_default.txt"

    # --------------------------------------------------------------------------
    # daily_summarize_template: путь к кастомному шаблону для daily summarize (ОПЦИОНАЛЬНО)
    # --------------------------------------------------------------------------
    # Если нужно использовать отдельный шаблон для ежедневной автоматической суммаризации
    # Указывается относительно корня проекта
    #
    # Если не задан, используется summarize_template (или дефолтный шаблон)
    #
    # Шаблоны используют синтаксис Jinja2 и поддерживают те же переменные, что и summarize_template
    #
    # Пример:
    #   daily_summarize_template: "templates/daily_summarize.txt"
    #
    # daily_summarize_template: "templates/custom_summarize.txt"

    # --------------------------------------------------------------------------
    # no_clear_after_summarize: не архивировать сообщения после суммаризации
    # --------------------------------------------------------------------------
    # true  - сообщения остаются в базе после суммаризации (не архивируются)
    # false - сообщения автоматически архивируются после успешной суммаризации
    #
    # Рекомендуется: false (по умолчанию), чтобы не накапливать старые сообщения
    #
    # no_clear_after_summarize: false

    # --------------------------------------------------------------------------
    # max_output_tokens: максимальное количество токенов для ответа LLM
    # --------------------------------------------------------------------------
    # Ограничивает максимальное количество токенов в ответе от LLM при суммаризации
    #
    # 0 или отсутствие - без ограничения (рекомендуется, если ответы обрезаются)
    # Любое положительное число - максимальное количество токенов в ответе
    #
    # ВАЖНО: Если ответ не помещается в max_output_tokens, суммаризация может
    # не выводиться или быть обрезанной. Если периодически возникают проблемы
    # с обрезанием ответов, установите 0 для отключения ограничения.
    #
    # Примеры:
    #   max_output_tokens: 0        - без ограничения (по умолчанию в коде: 65535 для structured, 32000 для fallback)
    #   max_output_tokens: 131072  - максимум 131072 токенов
    #   max_output_tokens: 32768   - максимум 32768 токенов
    #
    # max_output_tokens: 0

  # ----------------------------------------------------------------------------
  # НАСТРОЙКИ ОБРАБОТКИ ССЫЛОК (links_summarize)
  # ----------------------------------------------------------------------------
  # Управление автоматической суммаризацией ссылок в сообщениях
  # ----------------------------------------------------------------------------
  
  # --------------------------------------------------------------------------
  # links_summarize: суммаризировать содержимое ссылок для сохранения в БД
  # --------------------------------------------------------------------------
  # true  - бот скачивает содержимое ссылок и сохраняет краткий пересказ в текст сообщения
  #         для дальнейшей суммаризации вместе с остальными сообщениями
  # false - ссылки не обрабатываются, сохраняется только сам текст сообщения
  #
  # Формат сохранения: "По ссылке расположено: [краткое описание содержимого]"
  #
  links_summarize: false

  # --------------------------------------------------------------------------
  # links_summarize_show: отправлять тезисный пересказ ссылки в чат отдельным сообщением
  # --------------------------------------------------------------------------
  # true  - бот дополнительно отправляет в чат отдельным сообщением тезисный пересказ
  #         содержимого ссылки (более подробный, чем для сохранения в БД)
  # false - пересказ не отправляется в чат (только сохраняется в БД, если links_summarize: true)
  #
  # ВАЖНО: Работает только если links_summarize: true
  #
  links_summarize_show: false

  # --------------------------------------------------------------------------
  # youtube_summarize: суммаризировать только YouTube-ссылки
  # --------------------------------------------------------------------------
  # true  - обрабатывать только ссылки на YouTube (youtube.com, youtu.be)
  #         для обычных ссылок используется настройка links_summarize
  # false - YouTube-ссылки обрабатываются по общим правилам links_summarize
  #
  # Особенность: для YouTube используется получение субтитров через youtube-transcript-api
  #
  youtube_summarize: false

  # --------------------------------------------------------------------------
  # youtube_summarize_show: отправлять тезисный пересказ YouTube-видео в чат
  # --------------------------------------------------------------------------
  # true  - отправлять в чат отдельным сообщением тезисный пересказ YouTube-видео
  # false - пересказ не отправляется в чат
  #
  # ВАЖНО: Работает только если youtube_summarize: true
  #
  youtube_summarize_show: false

  # --------------------------------------------------------------------------
  # voice_recognition_enabled: включить/отключить распознавание голосовых сообщений
  # --------------------------------------------------------------------------
  # true  - бот будет автоматически распознавать голосовые сообщения, аудио и видеосообщения
  #         через WhisperX и сохранять транскрибированный текст в БД
  # false - распознавание голосовых сообщений отключено (по умолчанию)
  #
  # ВАЖНО: Для работы распознавания требуется установленный ffmpeg в системе
  # и библиотека WhisperX (устанавливается через pip install whisperx)
  #
  # Примеры:
  #   voice_recognition_enabled: true   - включить распознавание голосовых сообщений
  #   voice_recognition_enabled: false - отключить распознавание (по умолчанию)
  #
  voice_recognition_enabled: false

# ------------------------------------------------------------------------------
# ПЕРЕОПРЕДЕЛЕНИЯ ПО КОНКРЕТНЫМ ЧАТАМ (chats)
# ------------------------------------------------------------------------------
# Здесь можно указать индивидуальные настройки для каждого канала/группы
# Все параметры из секции defaults можно переопределить для конкретного чата
#
# Ключ может быть:
#   1. chat_id (как строка, начинается с "-" для групп/каналов)
#   2. username канала/группы (без '@', в нижнем регистре)
#
# КАК УЗНАТЬ CHAT_ID:
#   1. Добавьте бота @userinfobot в ваш канал/группу
#   2. Отправьте любое сообщение - бот покажет chat_id
#   3. Или используйте бота @RawDataBot для получения полной информации
#
# КАК УЗНАТЬ USERNAME:
#   - Для публичных каналов: это часть ссылки после t.me/
#     Например: t.me/my_channel → username: "my_channel"
#   - Для приватных каналов/групп: username может отсутствовать, используйте chat_id
#
# ------------------------------------------------------------------------------

chats:
  # ----------------------------------------------------------------------------
  # ПРИМЕР 1: Настройка по chat_id (рекомендуется для приватных каналов)
  # ----------------------------------------------------------------------------
  # Замените "-1001234567890" на реальный chat_id вашего канала/группы
  #
  "-1001234567890":
    # Переопределяем настройки тем для этого чата
    topics:
      only_top: false          # Включать все темы, не только топовые
      min_messages: 3          # Минимум 3 сообщения в теме
      max_topics: 8            # Максимум 8 тем в суммаризации
      show_users: false        # Не показывать участников
      user_list_length: 10     # Если показывать, то максимум 10
      show_user_links: true    # Показывать ссылки на профили (если show_users: true)

    # Переопределяем настройки суммаризации
    summarize:
      command_enabled: false   # Отключить команду /summarize для этого чата
      daily_enabled: false     # Отключить ежедневную суммаризацию
      daily_time: "10:00"      # Если бы была включена, отправлять в 10:00
      # Можно переопределить временную зону для этого чата:
      # timezone: "+03:00"
      # Время отсечки для команды /summarize (с этого времени сегодня до текущего момента):
      # summary_start_time: "06:00"
      # Отключить ограничение max_output_tokens (если ответы обрезаются):
      # max_output_tokens: 0

    # Переопределяем настройки обработки ссылок
    links_summarize: true      # Включить суммаризацию всех ссылок
    links_summarize_show: true # Отправлять пересказ ссылок в чат
    youtube_summarize: true    # Включить обработку YouTube
    youtube_summarize_show: true # Отправлять пересказ YouTube в чат

  # ----------------------------------------------------------------------------
  # ПРИМЕР 2: Настройка по chat_id с другой конфигурацией
  # ----------------------------------------------------------------------------
  "-1002510866758":
    topics:
      only_top: false
      min_messages: 3
      show_users: false
      user_list_length: 10
      show_user_links: true

    summarize:
      command_enabled: true    # Команда /summarize включена
      daily_enabled: false     # Ежедневная суммаризация отключена
      daily_time: "10:00"

    # Обрабатывать только YouTube, обычные ссылки не трогать
    links_summarize: true      # Нужно включить для работы youtube_summarize
    links_summarize_show: false # Не отправлять пересказ обычных ссылок в чат
    youtube_summarize: true    # Включить обработку YouTube
    youtube_summarize_show: false # Не отправлять пересказ YouTube в чат

  # ----------------------------------------------------------------------------
  # ПРИМЕР 3: Настройка по username (для публичных каналов)
  # ----------------------------------------------------------------------------
  # Используйте username без '@' и в нижнем регистре
  # Например, для канала @MyChannel используйте "mychannel"
  #
  "example_channel_username":
    topics:
      only_top: true           # Только топовые темы
      min_messages: 3          # Минимум 3 сообщения
      max_topics: 10           # Максимум 10 тем
      show_users: false        # Не показывать участников
      user_list_length: 10
      show_user_links: true    # Показывать ссылки на профили (если show_users: true)

    summarize:
      command_enabled: true    # Команда включена
      daily_enabled: false     # Ежедневная суммаризация отключена
      day_start_time: "06:00"  # День начинается в 6 утра
      daily_time: "10:00"      # Отправлять в 10:00
      no_clear_after_summarize: true  # Не архивировать сообщения после суммаризации

    # Отключить обработку ссылок для этого канала
    links_summarize: false
    links_summarize_show: false
    youtube_summarize: false
    youtube_summarize_show: false

# ==============================================================================
# ПОЛЕЗНЫЕ СОВЕТЫ ПО НАСТРОЙКЕ
# ==============================================================================
#
# 1. НАЧНИТЕ С ПРОСТОГО:
#    - Оставьте defaults как есть
#    - Добавьте только свой chat_id в секцию chats
#    - Постепенно настраивайте параметры под свои нужды
#
# 2. ДЛЯ АКТИВНЫХ КАНАЛОВ (много сообщений):
#    - Установите min_messages: 5-10
#    - Установите max_topics: 10-20
#    - Установите show_users: false (чтобы не перегружать вывод)
#
# 3. ДЛЯ НЕБОЛЬШИХ КАНАЛОВ (мало сообщений):
#    - Установите min_messages: 1-2
#    - Установите max_topics: 0 (без ограничения)
#    - Можно включить show_users: true
#
# 4. ДЛЯ ЕЖЕДНЕВНОЙ СУММАРИЗАЦИИ:
#    - Установите daily_enabled: true
#    - Настройте daily_time (например, "23:00" для вечернего дайджеста)
#    - Настройте cron или планировщик задач (см. daily_summary.py)
#
# 5. ДЛЯ ОБРАБОТКИ ССЫЛОК:
#    - links_summarize: true - для сохранения пересказа в БД
#    - links_summarize_show: true - для отправки пересказа в чат
#    - youtube_summarize: true - для отдельной обработки YouTube
#
# 6. ЕСЛИ ОТВЕТЫ ОБРЕЗАЮТСЯ ИЛИ НЕ ВЫВОДЯТСЯ:
#    - Установите max_output_tokens: 0 для отключения ограничения
#    - Или увеличьте значение (например, max_output_tokens: 131072)
#    - Проверьте логи в папке logs/llm_structured.log для диагностики
#
# 7. ПРОВЕРКА НАСТРОЕК:
#    - После изменения config.yaml перезапустите бота
#    - Используйте команду /summarize для тестирования
#    - Проверьте логи в папке logs/ при возникновении проблем
#
# ==============================================================================

